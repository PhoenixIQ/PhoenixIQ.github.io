"use strict";(self.webpackChunkphoenixiq_github_io=self.webpackChunkphoenixiq_github_io||[]).push([[554],{43994:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>x,contentTitle:()=>s,default:()=>o,frontMatter:()=>r,metadata:()=>d,toc:()=>c});var l=n(85893),i=n(11151);const r={id:"annotation-resolver",title:"\u6ce8\u89e3\u89e3\u6790\u5668",description:"\u7528\u4e8e\u5c06 Spring \u914d\u7f6e\u89e3\u6790\u6210\u6ce8\u89e3\u914d\u7f6e"},s=void 0,d={id:"phoenix-advanced/annotation-resolver",title:"\u6ce8\u89e3\u89e3\u6790\u5668",description:"\u7528\u4e8e\u5c06 Spring \u914d\u7f6e\u89e3\u6790\u6210\u6ce8\u89e3\u914d\u7f6e",source:"@site/docs/09-phoenix-advanced/07-annotation-resolver.md",sourceDirName:"09-phoenix-advanced",slug:"/phoenix-advanced/annotation-resolver",permalink:"/docs/phoenix-advanced/annotation-resolver",draft:!1,unlisted:!1,editUrl:"https://github.com/PhoenixIQ/docs/09-phoenix-advanced/07-annotation-resolver.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{id:"annotation-resolver",title:"\u6ce8\u89e3\u89e3\u6790\u5668",description:"\u7528\u4e8e\u5c06 Spring \u914d\u7f6e\u89e3\u6790\u6210\u6ce8\u89e3\u914d\u7f6e"},sidebar:"docs",previous:{title:"\u96c6\u7fa4\u8ba1\u7b97\u6c60",permalink:"/docs/phoenix-advanced/cluster-pool"},next:{title:"Phoenix \u6269\u5c55",permalink:"/docs/phoenix-advanced/extension"}},x={},c=[{value:"\u7b80\u4ecb",id:"introduce",level:2},{value:"\u5b9e\u4f53\u805a\u5408\u6839\u6ce8\u89e3",id:"entity-annotation-config",level:2},{value:"\u4e8b\u52a1\u805a\u5408\u6839\u6ce8\u89e3",id:"transaction-annotation-config",level:2}];function a(e){const t={blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.h2,{id:"introduce",children:"\u7b80\u4ecb"}),"\n",(0,l.jsx)(t.p,{children:"\u805a\u5408\u6839\u6ce8\u89e3\u4e2d\u7684\u5927\u90e8\u5206\u914d\u7f6e\u7528\u4e8e\u805a\u5408\u6839\u7684\u8fd0\u884c\u6027\u80fd\u8c03\u4f18\uff0c\u4e0d\u9650\u4e8e\u8fd0\u884c\u6a21\u5f0f\u3001\u6512\u6279\u6b21\u6570\u3001\u5feb\u7167\u95f4\u9694\u7b49\uff0c\u7136\u800c\u5728\u5b9e\u9645\u751f\u4ea7\u8fd0\u884c\u4e2d\uff0c\u9700\u8981\u901a\u8fc7\u4fee\u6539\u4ee3\u7801\u7684\u65b9\u5f0f\u6765\u8ba9\u6ce8\u89e3\u751f\u6548\u662f\u5341\u5206\u4e0d\u5229\u4e8e\u9891\u7e41\u7684\u538b\u6d4b\u4ee5\u53ca\u7d27\u6025\u914d\u7f6e\u4fee\u590d\u7684\u3002\n\u56e0\u6b64 Phoenix \u5185\u7f6e\u4e86\u6ce8\u89e3\u89e3\u6790\u5668\u7528\u4e8e\u5c06 Spring \u7684\u914d\u7f6e\u89e3\u6790\u6210\u805a\u5408\u6839\u7684\u6ce8\u89e3\u914d\u7f6e\uff0c\u53ef\u7528\u4e8e\u4ee5\u4e0b\u4e24\u79cd\u7c7b\u578b\uff1a"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.code,{children:"@EntityAggregateAnnotation"}),": \u5b9e\u4f53\u805a\u5408\u6839\u6ce8\u89e3"]}),"\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.code,{children:"@TransactionAggregateAnnotation"}),": \u4e8b\u52a1\u805a\u5408\u6839\u6ce8\u89e3"]}),"\n"]}),"\n",(0,l.jsx)(t.p,{children:"\u4ece Phoenix 2.2.4\u5f00\u59cb\uff0c\u4f9d\u8d56\u4e86 phoenix-stater \u7684\u73af\u5883\u4e0b\uff0c\u805a\u5408\u6839\u652f\u6301\u4ece\u542f\u52a8\u53c2\u6570/\u73af\u5883\u53d8\u91cf/\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u53c2\u6570\u3002"}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsx)(t.p,{children:"\u5728 Phoenix 2.6.0 \u5f00\u59cb\uff0c\u4e8b\u52a1\u652f\u6301\u4e5f\u652f\u6301\u6ce8\u89e3\u89e3\u6790"}),"\n"]}),"\n",(0,l.jsx)(t.p,{children:"\u914d\u7f6e\u4f18\u5148\u7ea7:\u542f\u52a8\u53c2\u6570 > \u73af\u5883\u53d8\u91cf > \u914d\u7f6e\u6587\u4ef6 > \u4ee3\u7801\u6ce8\u89e3\u81ea\u5b9a\u4e49 > \u6ce8\u89e3\u9ed8\u8ba4\u503c"}),"\n",(0,l.jsx)(t.p,{children:"\u805a\u5408\u6839 Spring \u7684\u901a\u7528\u914d\u7f6e\u5c42\u6b21\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"quantex:\n  phoenix:\n    server:\n      <\u6ce8\u89e3\u7c7b\u578b\uff1aentityAggregate/transactionAggregate>:\n        <\u805a\u5408\u6839\u7c7b\u578b: XX>\n          <\u6ce8\u89e3\u914d\u7f6e1: surviveTime>: 1000\n          <\u6ce8\u89e3\u914d\u7f6e2: batchWeight>: 200\n\n"})}),"\n",(0,l.jsx)(t.h2,{id:"entity-annotation-config",children:"\u5b9e\u4f53\u805a\u5408\u6839\u6ce8\u89e3"}),"\n",(0,l.jsxs)(t.p,{children:["\u5b9e\u4f53\u805a\u5408\u6839\u7684\u6ce8\u89e3\u4ee5\uff1a",(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate"})," \u5f00\u5934, \u5e76\u5728\u540e\u9762\u9644\u52a0\u805a\u5408\u6839\u7c7b\u578b\u548c\u5b9e\u9645\u6ce8\u89e3"]}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u914d\u7f6e\u9879"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u7c7b\u578b"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u5bf9\u5e94\u7684\u6ce8\u89e3\u51fd\u6570"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"{aggregateRootType}"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u7c7b\u578b\uff0c\u65e0\u6cd5\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bfb\u53d6"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"aggregateRootType"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.surviveTime"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u751f\u5b58\u65f6\u95f4"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"surviveTime"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.snapshotMode"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5feb\u7167\u6a21\u5f0f"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"enum"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"snapshotMode"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.snapshotInterval"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5feb\u7167\u95f4\u9694"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"snapshotInterval"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.numberOfRetainSnapshots"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u9700\u8981\u4fdd\u7559\u7684\u5feb\u7167\u6570\u91cf"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"numberOfRetainSnapshots"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.idempotentSize"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u5e42\u7b49\u96c6\u5408\u5927\u5c0f"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"idempotentSize"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.bloomSize"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u5927\u5c0f"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"bloomSize"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.dispatcher"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u8fd0\u884c\u7ebf\u7a0b\u6c60"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"string"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"dispatcher"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.runningMode"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u8fd0\u884c\u6a21\u5f0f"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"enum string"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"runningMode"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.allowPassivation"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u662f\u5426\u5141\u8bb8\u949d\u5316"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"boolean"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"allowPassivation"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.batchWeight"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u6d88\u606f\u6512\u6279\u7684\u6700\u5927\u6279\u6b21"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"batchWeight"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.entityAggregate.{aggregateRootType}.bufferSize"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5f02\u6b65\u6a21\u5f0f\u4e0b\uff0c\u6301\u4e45\u5316\u65f6\u5141\u8bb8\u7f13\u5b58\u7684\u6d88\u606f\u6279\u6b21\uff08package)\u6570\u91cf"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Int"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"bufferSize"})]})]})]}),"\n",(0,l.jsx)(t.p,{children:"\u4ee5yaml\u914d\u7f6e\u6587\u4ef6\u4e3a\u4f8b:"}),"\n",(0,l.jsxs)(t.p,{children:["\u5f53\u4f7f\u7528\u4e86",(0,l.jsx)(t.code,{children:"@EntityAggregateAnnotation"}),"\uff0c\u5e76\u4e14",(0,l.jsx)(t.code,{children:"aggregateRootType"}),"\u4e3a",(0,l.jsx)(t.code,{children:"BankAccount"}),"\u3002\u5219:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"quantex:\n  phoenix:\n    server:\n      entityAggregate:\n        BankAccount: # {aggregateRootType}\n          surviveTime: 10\n          snapshotInterval: 10\n          idempotentSize: 10\n          bloomSize: 10\n"})}),"\n",(0,l.jsx)(t.h2,{id:"transaction-annotation-config",children:"\u4e8b\u52a1\u805a\u5408\u6839\u6ce8\u89e3"}),"\n",(0,l.jsxs)(t.p,{children:["\u4e8b\u52a1\u805a\u5408\u6839\u7684\u6ce8\u89e3\u4ee5\uff1a",(0,l.jsx)(t.code,{children:"quantex.phoenix.server.transactionAggregate"})," \u5f00\u5934, \u5e76\u5728\u540e\u9762\u9644\u52a0\u805a\u5408\u6839\u7c7b\u578b\u548c\u5b9e\u9645\u6ce8\u89e3"]}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u914d\u7f6e\u9879"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u7c7b\u578b"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u5bf9\u5e94\u7684\u6ce8\u89e3\u51fd\u6570"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"{aggregateRootType}"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u7c7b\u578b\uff0c\u65e0\u6cd5\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bfb\u53d6"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"aggregateRootType"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.transactionAggregate.{aggregateRootType}.heartbeatTickInterval"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5fc3\u8df3\u6ef4\u7b54\u95f4\u9694(\u79d2)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"heartbeatTickInterval"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.transactionAggregate.{aggregateRootType}.heartbeatCheckInterval"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5fc3\u8df3\u68c0\u67e5\u95f4\u9694(\u79d2)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"heartbeatCheckInterval"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.transactionAggregate.{aggregateRootType}.retryStrategy"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u91cd\u8bd5\u7b56\u7565(\u6307\u6570\u9000\u907f\u548c\u56fa\u5b9a\u9891\u7387)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"enum"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"retryStrategy"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.transactionAggregate.{aggregateRootType}.maxRetryNum"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u4e8b\u52a1\u603b\u8d85\u65f6\u6b21\u6570(\u6700\u5927\u5fc3\u8df3\u68c0\u67e5\u95f4\u9694\uff09"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"maxRetryNum"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"quantex.phoenix.server.transactionAggregate.{aggregateRootType}.batchWeight"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u805a\u5408\u6839\u6d88\u606f\u6512\u6279\u7684\u6700\u5927\u6279\u6b21"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"batchWeight"})]})]})]}),"\n",(0,l.jsx)(t.p,{children:"\u4ee5yaml\u914d\u7f6e\u6587\u4ef6\u4e3a\u4f8b:"}),"\n",(0,l.jsxs)(t.p,{children:["\u5f53\u4f7f\u7528\u4e86",(0,l.jsx)(t.code,{children:"@TransactionAggregateAnnotation"}),"\uff0c\u5e76\u4e14",(0,l.jsx)(t.code,{children:"aggregateRootType"}),"\u4e3a",(0,l.jsx)(t.code,{children:"BankTransferSaga"}),"\u3002\u5219:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"quantex:\n  phoenix:\n    server:\n      transactionAggregate:\n        BankTransferSaga: # {aggregateRootType}\n          heartbeatTickInterval: 2\n          heartbeatCheckInterval: 2\n          maxRetryNum: 10\n"})})]})}function o(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>d,a:()=>s});var l=n(67294);const i={},r=l.createContext(i);function s(e){const t=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),l.createElement(r.Provider,{value:t},e.children)}}}]);