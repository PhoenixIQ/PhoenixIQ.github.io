---
id: available-test-2x
title: 可用性测试
---

## 高可用性测试

### 高可用性测试定义
> 高可用性指系统无中断地执行其功能的能力，代表系统的可用性程度。是进行系统设计时的准则之一。高可用性系统与构成该系统的各个组件相比可以更长时间运行。高可用性通常通过提高系统的容错能力来实现。
>
> 系统的高可用性可以使用以下两个指标衡量：
>
> 1. 恢复时间目标(RTO)：RTO指在业务可接受的范围内，应用系统最多可以中断或关闭（业务不可用）多长时间。
> 2. 恢复点目标(RPO)：RPO指在业务可接受的范围内，应用系统最多可在系统故障恢复后丢失多长时间的业务数据。



### 为什么需要高可用性测试
在建立稳健的生产系统时，最大限度地减少停机时间和服务中断通常是首要任务。在系统承载重要任务的情况下，系统故障带来的业务数据丢失或是长时间业务不可用往往带来不可估量的后果，这都是不可接受的。所以系统的高可用性在特定的应用领域重显得尤为重要，通常作为系统设计的重要考量因素。

Phoenix框架致力于构建高可用的应用服务系统，可通过部署多活服务集群来消除服务的单点故障，以满足应用服务的高可用性的要求。所以，我们需要对Phoenix框架构建的服务进行高可用性测试，通过得到RTO和RPO指标，来衡量使用Phoenix框架构建的应用服务系统能否满足指定业务的高可用性要求。

### 测试方案
Phoenix框架高可用性测试基于bank-account示例应用进行。部署多个服务实例构建多活服务集群作为测试的目标系统，通过手动关闭一个或若干服务实例模拟系统发生故障。
#### 测试场景
1. 在测试环境部署多活bank-account服务，实例数量为3个。在服务启动正常后以固定流量发送请求并持续一定时间。
2. 期间手动关闭1个服务实例以模拟故障。使用Grafana监控工具监控请求的处理情况和业务状态，统计服务在测试过程中中断请求响应的时间长短，确定故障恢复后的数据状态正确性，计算本次测试中系统可达到的RTO和RPO指标。

#### 校验方法
测试过程中使用Grafana监控请求的处理情况，通过Grafana可得到在系统发生故障时，系统响应请求的中断时间长短，统计该时间作为系统可达到的故障恢复时间，即作为系统的RTO指标；在故障恢复后，通过bank-account提供的业务数据校验功能，确认故障恢复后，所有业务数据状态没有出错和丢失。若故障恢复后，所有业务数据状态均正常，则可认为系统可达到的RPO指标为0。

### 测试步骤
### 测试结果