---
id: reliability-test-2x
title: 可靠性测试
---

## 概述

可靠性指的是软件系统在规定的时间内以及规定的环境条件下,完成规定功能的能力。

Phoenix作为分布式微服务架构，必须要保证每一步的可靠性，比如说处理能力的可靠性，消息流转的可靠性（即消息不丢，传则必达）。由于Phoenix是基于EventSource思想打造的架构，因此我们也必须保证EventSourcing的可靠性。

## 测试方案（处理可靠性）

### 测试场景

Phoenix框架高可用性测试（处理可靠性）基于bank-account示例应用进行。通过模拟一笔资金划拨指令，观察系统处理结果后的前端页面，证明Phoenix可以正确处理请求。

### 校验方法

观察bank-account-server工程的前端页面，最终的处理结果无误则证明Phoenix具有出处理可靠性。

### 测试步骤

1. 使用bank-account服务，在前端发起一笔资金划拨。给账户[account_1]划拨100元等待请求返回。

   （截图：前端下单图）

2. 请求返回结果为划拨成功后，刷新前端页面数据，查看所有账户的资金数据。

   （截图：前端查询列表）

3. 由查询结果可知，账户[account_1]的最终金额为1100元（每个账户默认有1000元的初始资金）。Phoenix正确处理了前端请求，具有处理可靠性。

## 测试方案（重启可靠性）

### 测试场景

Phoenix框架高可用性测试（重启可靠性）基于bank-account示例应用进行。通过模拟应用处理完毕批量请求后，进行服务重启。证明重启完毕后，应用数据能恢复到重启前的状态。

### 校验方法

观察bank-account-server工程处理批量请求并重启这一操作前后的前端页面，一致则证明Phoenix具有重启可靠性。

### 测试步骤

1. 使用bank-account服务，在前端发起批量资金划拨。全部处理完毕后，刷新页面数据，查看所有账户的资金数据。（截图：前端下单图，处理完的结果表格）

2. 待请求全部处理完毕后，重启服务节点。

   （截图：rancher重启的图）

3. 重启完毕后，刷新页面数据，查看所有账户的资金数据。

   （截图：前端表格）

4. 对比重启前后的账户表格，发现完全一致。Phoenix具有重启可靠性。

## 测试方案（投递可靠性）

### 测试场景

Phoenix框架高可用性测试（投递可靠性）基于bank-account示例应用进行。通过模拟集群内节点网络通信的断开和恢复，证明消息依然能够保证有效流转。

### 校验方法

观察bank-account-server工程在经历过数次集群节点之间网络通信的故障和恢复之后，前端页面上展示的处理结果依然准确无误，则证明Phoenix具有投递可靠性。

### 测试步骤

1. 在测试环境部署多活bank-account服务，实例数量为3个。在服务启动正常后以固定流量发送批量划拨请求并持续一定时间。（截图：前端下单图）

2. 在前端的持续过程流量中，使用工具阻断3个实例之间的网络，并恢复。这个操作持续多次。

   （截图：使用工具切割网络的图）

3. 停止流量，待所有请求处理完毕。对比前端页面中转入和转出次数之和，与和步骤1中的划拨总次数，完全一致。Phoenix具有投递可靠性。

   （截图：框出来转入转出次数）

## 结论

经验值，Phoenix具有可靠性。