---
id: phoenix-lite-feature-2x
title: 特性介绍
---

## 有状态

所有的计算都在内存中进行

消息幂等在内存中维护有幂等队列


## 事件存储

eventstore保证消息有序不丢，在服务宕机恢复是可通过从eventstore中拉取消息恢复内存状态


## 事件溯源/快照

事件溯源是宕机服务恢复内存状态的一种实现方式，phoenix中通过拉取eventstore中的有序消息，重走一遍处理过程来恢复内存状态。快照是某一时刻内存状态的备份，可以用来加速eventsourcing的恢复速度。


## 消息驱动

消息是指发送到特定目的地的一组特定数据。 在消息驱动的系统中， 可寻址的接收者等待消息的到来， 并对消息做出反应， 否则只是休眠（即异步非阻塞地等待消息的到来）。 消息驱动的系统着重于可寻址的接收者。 


## 消息幂等

phoenix 通过重发机制来保证消息的可靠性投递，需要设计消息幂等机制来保证同一个消息不会被多次处理。

phoenix 通过两种方式来实现消息幂等

 - 在内存中维护一个固定大小的幂等队列
 - 通过 eventstore 的主键和唯一键索引冲突，来防止将同一消息持久化多次

phoenix 维护了一个1000大小的幂等集合，来存储最新处理的1000个消息的msgId，通过该集合来保证消息的幂等。由于某些不可预测的原因，可能该幂等集合幂等失败，这个时候我们可以通过eventstore表的主键和唯一键索引来保证幂等。（消息产生之后在处理之前需要先执行eventstore操作将消息持久化下来。）


## 事件驱动

事件是组件在达到了某个给定状态时所发出的信号。 在事件驱动的系统中， 通知监听器被附加到了事件源， 以便在事件被发出时调用它们（指回调）。 这也就意味着， 事件驱动的系统关注于可寻址的事件源。

由于事件消耗链的短暂性， 所以在事件驱动的系统中很难实现回弹性 ： 当处理过程已经就绪，监听器已经设置好， 以便于响应结果并对结果进行变换时， 这些监听器通常都将直接地处理成功或者失败， 并向原始的客户端报告执行结果。（这些监听器）响应组件的失败， 以便于恢复它（指失败的组件）的正常功能，而在另外一方面， 需要处理的是那些并没有与短暂的客户端请求捆绑在一起的， 但是影响了整个组件的健康状况的失败。