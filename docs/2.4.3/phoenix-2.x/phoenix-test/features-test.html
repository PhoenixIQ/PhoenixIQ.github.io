<!doctype html>
<html lang="zh-cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.4.3 docs-doc-page docs-doc-id-phoenix-2.x/phoenix-test/features-test" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">功能性测试 | Phoenix</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="http://phoenix-website.sz.iquantex.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="http://phoenix-website.sz.iquantex.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="http://phoenix-website.sz.iquantex.com/docs/2.4.3/phoenix-2.x/phoenix-test/features-test"><meta data-rh="true" property="og:locale" content="zh_cn"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docusaurus_version" content="2.4.3"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.4.3"><meta data-rh="true" name="docsearch:version" content="2.4.3"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.4.3"><meta data-rh="true" property="og:title" content="功能性测试 | Phoenix"><meta data-rh="true" name="description" content="概述"><meta data-rh="true" property="og:description" content="概述"><link data-rh="true" rel="icon" href="/img/phoenix.png"><link data-rh="true" rel="canonical" href="http://phoenix-website.sz.iquantex.com/docs/2.4.3/phoenix-2.x/phoenix-test/features-test"><link data-rh="true" rel="alternate" href="http://phoenix-website.sz.iquantex.com/docs/2.4.3/phoenix-2.x/phoenix-test/features-test" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="http://phoenix-website.sz.iquantex.com/docs/2.4.3/phoenix-2.x/phoenix-test/features-test" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Phoenix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Phoenix Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9b752ffb.css">
<script src="/assets/js/runtime~main.81fe3275.js" defer="defer"></script>
<script src="/assets/js/main.8458ada4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Phoenix Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.png" alt="Phoenix Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">首页</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">文档</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/introduce">介绍</a></li><li><a class="dropdown__link" href="/docs/phoenix">快速入门</a></li><li><a class="dropdown__link" href="/docs/phoenix-core">Phoenix 框架</a></li><li><a class="dropdown__link" href="/docs/phoenix-transaction">Phoenix 事务</a></li><li><a class="dropdown__link" href="/docs/phoenix-observability">Phoenix 可观测性</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/2.4.3/phoenix-2.x/phoenix/phoenix-introduce">2.4.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/introduce">latest</a></li><li><a class="dropdown__link" href="/docs/2.6.0/introduce">2.6.0</a></li><li><a class="dropdown__link" href="/docs/2.5.5/phoenix-2.x/phoenix-test/features-test">2.5.5</a></li><li><a class="dropdown__link" href="/docs/2.5.4/phoenix-2.x/phoenix-test/features-test">2.5.4</a></li><li><a class="dropdown__link" href="/docs/2.5.3/phoenix-2.x/phoenix-test/features-test">2.5.3</a></li><li><a class="dropdown__link" href="/docs/2.5.2/phoenix-2.x/phoenix-test/features-test">2.5.2</a></li><li><a class="dropdown__link" href="/docs/2.5.1/phoenix-2.x/phoenix-test/features-test">2.5.1</a></li><li><a class="dropdown__link" href="/docs/2.5.0/phoenix-2.x/phoenix-test/features-test">2.5.0</a></li><li><a class="dropdown__link" href="/docs/2.4.4/phoenix-2.x/phoenix-test/features-test">2.4.4</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.4.3/phoenix-2.x/phoenix-test/features-test">2.4.3</a></li><li><a class="dropdown__link" href="/docs/2.4.2/phoenix-2.x/phoenix-test/features-test">2.4.2</a></li><li><a class="dropdown__link" href="/docs/2.4.1/phoenix-2.x/phoenix-test/features-test">2.4.1</a></li><li><a class="dropdown__link" href="/docs/2.4.0/phoenix-2.x/phoenix-test/features-test">2.4.0</a></li><li><a class="dropdown__link" href="/docs/2.2.4/phoenix-2.x/phoenix">2.2.4</a></li></ul></div><a href="https://github.com/PhoenixIQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">整体介绍</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix/phoenix-introduce">Phoenix介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix/why-event-driven-microservice">为什么需要事件驱动型微服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix/how-event-driven-microservice">Phoenix实现事件驱动型微服务</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix/quick-start-example/bookings-architecture">快速入门案例</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix/phoenix-all-future">功能总览</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix/phoenix-glossary">Phoenix概念</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix/phoenix-faq">FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Phoenix Framework</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-core-client">客户端介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-core-entity-aggregate">实体聚合根</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-core-event-souring">事件溯源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-core-event-store">事件管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-distributed-data">分布式数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-subscribe-pub">订阅与广播</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-cluster-manager">集群管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-core/phoenix-core-config">配置详情</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Phoenix Transaction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-transaction/phoenix-transaction-module">事务模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-transaction/phoenix-transaction-aggregate">使用说明</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Phoenix Event Publish</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-event-publish/event-publish-readme">功能介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-event-publish/event-publish-integration">使用说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-event-publish/event-publish-client-usage">订阅事件</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Phoenix DGC</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-dgc/phoenix-dgc-introduce">背景介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-dgc/phoenix-dgc-api">使用说明</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Phoenix 监控管理</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-console/phoenix-console-overall">服务 架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-console/phoenix-console-service-management">服务管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-console/phoenix-console-business-monitor">业务监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-console/phoenix-console-system-monitor">系统监控</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">测试报告</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-test/features-test">功能性测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-test/performance-test">性能测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-test/available-test">可用性测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-test/elasticity-test">伸缩性测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-test/reliability-test">可靠性测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-test/pressure-test">压力测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.4.3/phoenix-2.x/phoenix-test/balance-test">均衡性测试</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>此为 <!-- -->Phoenix<!-- --> <b>2.4.3</b> 版的文档，现已不再积极维护。</div><div class="margin-top--md">最新的文档请参阅 <b><a href="/docs/introduce">最新版本</a></b> (<!-- -->latest<!-- -->)。</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">测试报告</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">功能性测试</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：2.4.3</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>功能性测试</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h2>
<p>Phoenix 是宽拓自主研发的一款消息驱动型的高性能 Java 开发框架，专注于降低金融行业中业务复杂性高、性能要求高的应用系统的开发难度，助力研发团队打造专业、高效的微服务化的金融应用系统。
本篇测试报告主要验证了 Phoenix 提供的如下功能:</p>
<ul>
<li>基于 bank-account 账户划拨功能正常</li>
<li>Grafana 使用正常</li>
<li>EventSourcing 使用正常</li>
<li>Snapshot 使用正常</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bank-account-划拨功能">bank-account 划拨功能<a href="#bank-account-划拨功能" class="hash-link" aria-label="bank-account 划拨功能的直接链接" title="bank-account 划拨功能的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-1">概述<a href="#概述-1" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>验证 bank-account 账户划拨功能是否可以正常使用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍">原理介绍<a href="#原理介绍" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<p>bank-account 提供了随机划拨和定向划拨两个功能:</p>
<ol>
<li>定向划拨:指定账户进行转入转出操作（每个账户默认初始有100元，划拨金额大于0为转入操作，划拨金额小于0为转出操作）</li>
<li>随机划拨:指定账户范围和转账次数，多个账户同时进行划拨操作。</li>
</ol>
<p><img loading="lazy" alt="show" src="/assets/images/1-2139981a0eaac7564c459aa82a999f75.png" width="1634" height="1285" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案">测试方案<a href="#测试方案" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景描述">场景描述<a href="#场景描述" class="hash-link" aria-label="场景描述的直接链接" title="场景描述的直接链接">​</a></h4>
<p>分别使用 bank-account 提供的两个划拨接口进行下单测试。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="校验方法">校验方法<a href="#校验方法" class="hash-link" aria-label="校验方法的直接链接" title="校验方法的直接链接">​</a></h4>
<ul>
<li>定向划拨:每次划拨之后校验余额</li>
<li>随机划拨:转入次数 + 转出次数 + 错误转出 = 转账次数</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤">测试步骤<a href="#测试步骤" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<ol>
<li>使用 bank-account 的下单页面以每秒 100 笔的速率下单，同时限制账户个数为 10 个，划拨总次数为 1000</li>
<li>待下单完毕后，进行校验.
使用 bank-account 的内存查询接口查询内存数据 (转入次数 + 转出次数 + 错误转出 = 转账次数)</li>
</ol>
<p><img loading="lazy" alt="show" src="/assets/images/2-82a644220721b0e930acaa966c69cff3.png" width="1622" height="1320" class="img_ev3q"></p>
<ol start="3">
<li>
<p>使用定向转账功能，从 A00000000 账户中转出 100 元（通过以上图片发现经过随机转账之后 A00000000 账户中余额为 280 元）
转账之后，通过内存查询接口查看账户余额（余额为 180 元）（定向划拨中的划拨编号可以用来测试幂等逻辑，如果本次划拨编号和上次划拨编号一直，则账户金额不会有任何变动）</p>
<p><img loading="lazy" alt="show" src="/assets/images/3-4af07ca442f11f58315b86cbfbb3296d.png" width="1593" height="1306" class="img_ev3q"></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果">测试结果<a href="#测试结果" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<p>符合预期，bank-account 账户划拨功能可以正常使用。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="phoenix-metrics-功能">phoenix metrics 功能<a href="#phoenix-metrics-功能" class="hash-link" aria-label="phoenix metrics 功能的直接链接" title="phoenix metrics 功能的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-2">概述<a href="#概述-2" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>Phoenix 联合 Grafana 提供了一套监控服务，可用于监控 Phoenix 应用运行过程中的各项指标。根据面板可以分为以下几块:</p>
<ul>
<li>phoenix jvm</li>
<li>phoenix source aggregate</li>
<li>phoenix entity aggregate</li>
<li>phoenix transaction aggregate</li>
<li>phoenix event store</li>
<li>phoenix message elasticsearch</li>
<li>phoenix event publish</li>
<li>phoenix client</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍-1">原理介绍<a href="#原理介绍-1" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<p>通过在 bank-account 服务中进行埋点，并将相应的数据上传至 Elasticsearch 最终通过 Grafana 友好的展示出来。不仅可以实时的监控 Phoenix 应用每次下单之后的运行情况，还可以分析上面的指标判断服务的性能。</p>
<ul>
<li>phoenix source aggregate、phoenix entity aggregate、phoenix transaction aggregate、phoenix event store、phoenix event publish、phoenix client、phoenix jvm: 这些面板中的数据采用 JMX + Prometheus + Grafana监控机制，可以实时采集服务的运行情况 ，并通过 Grafana进行展示,其中 JVM 和 phoenix overview 采集的phoenix server服务指标</li>
<li>phoenix message:该面板展示了phoenix server处理后的所有事件的监控数据，EventPublish 将事件上传到消息队列，通过配置phoenix admin服务的上报配置，phoenix admin服务会将指定的消息队列中的事件数据持久化到 Elasticsearch 服务中，最后在Grafana进行展示</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案-1">测试方案<a href="#测试方案-1" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景描述-1">场景描述<a href="#场景描述-1" class="hash-link" aria-label="场景描述的直接链接" title="场景描述的直接链接">​</a></h4>
<p>使用 bank-account 提供的随机划拨功能以固定的速率进行下单测试，然后打开 Grafana 监控面板监测数据。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="校验方法-1">校验方法<a href="#校验方法-1" class="hash-link" aria-label="校验方法的直接链接" title="校验方法的直接链接">​</a></h4>
<p>观察 Grafana 中展示出来的各个指标是否符合预期</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤-1">测试步骤<a href="#测试步骤-1" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<ol>
<li>
<p>使用 bank-account 的下单页面以每秒 100 笔的速率下单，同时限制账户个数为 10 个，划拨总次数为 10000</p>
</li>
<li>
<p>待下单完毕后，进行校验。
通过 Grafana 可视化面板查看</p>
<p><img loading="lazy" alt="show" src="/assets/images/4-be1423431ab02ccae750703ca9d37178.png" width="2560" height="1369" class="img_ev3q"></p>
<p><img loading="lazy" alt="show" src="/assets/images/23-a8b4b69bf88bd2efdf6d535bc4f37c45.png" width="2504" height="1087" class="img_ev3q"></p>
<p>通过 Grafana 可视化面板可以观察到一共发送了 10000 条消息（总事务 = 10000）,并全部处理完成。整个处理过程耗时平均在 30 ms以下。</p>
</li>
<li>
<p>在phoenix overview 根据实例IP地址查看其中一个节点的处理情况</p>
<p><img loading="lazy" alt="show" src="/assets/images/8-3b601495282dab55cf1eaad6d13df8ca.png" width="2560" height="1369" class="img_ev3q"></p>
<p>通过上图我们还可以看出来，该节点一共处理了 5000 笔请求（一个 10000 笔请求，共两个处理节点），说明了多个节点之间是可以做到负载均衡的。</p>
</li>
<li>
<p>在phoenix message 面板通过查看每一类消息的处理情况（这里查看划拨失败事件的处理情况）</p>
<p><img loading="lazy" alt="show" src="/assets/images/9-1b163e842b9f90483ca807bd3b4963df.png" width="2560" height="1440" class="img_ev3q"></p>
</li>
<li>
<p>phoenix client监控图</p>
<p><img loading="lazy" alt="show" src="/assets/images/24-b8eb3225c5f15951e3f662fcb06bd75b.png" width="2560" height="1369" class="img_ev3q"></p>
</li>
<li>
<p>phoenix eventPublish 监控图</p>
<p><img loading="lazy" alt="show" src="/assets/images/25-0043ecc3e8fdd4e0f171e79958d23986.png" width="2560" height="1369" class="img_ev3q"></p>
</li>
<li>
<p>JVM 监控图</p>
<p><img loading="lazy" alt="show" src="/assets/images/26-98eba8874301af64e8a746fe39eb840f.png" width="2560" height="1440" class="img_ev3q"></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果-1">测试结果<a href="#测试结果-1" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<p>符合预期，可以证明 Grafana 监控功能够可以正常使用</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="phoenix-console-功能">phoenix console 功能<a href="#phoenix-console-功能" class="hash-link" aria-label="phoenix console 功能的直接链接" title="phoenix console 功能的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-3">概述<a href="#概述-3" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>phoenix console是 Phoenix 框架默认提供的轻量级、嵌入式监控平台，该平台共提供四大操作模块：</p>
<ul>
<li>overview</li>
<li>cluster</li>
<li>state manager</li>
<li>event manager</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍-2">原理介绍<a href="#原理介绍-2" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<p>phoenix console支持对 Phoenix 服务进行系统状态管理、事件管理、性能监控、业务监控、事务调用链追踪以及异常分析。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案-2">测试方案<a href="#测试方案-2" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="校验方法-2">校验方法<a href="#校验方法-2" class="hash-link" aria-label="校验方法的直接链接" title="校验方法的直接链接">​</a></h4>
<p>观察 phoenix console 中展示出来的各个功能是否符合预期、是否正常使用</p>
<p>服务地址：IP/phx-console</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤-2">测试步骤<a href="#测试步骤-2" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<ol>
<li>
<p>使用 bank-account 的下单页面以每秒 100 笔的速率下单，同时限制账户个数为 10 个，划拨总次数为 10000</p>
</li>
<li>
<p>待下单完毕后，进行校验。
通过 phoenix console 可视化页面查看</p>
</li>
<li>
<p>应用总览</p>
</li>
</ol>
<p><img loading="lazy" alt="show" src="/assets/images/30-7e7babe279ac3d194ade2509c107b5a8.png" width="2560" height="1369" class="img_ev3q"></p>
<ol start="4">
<li>扇子图</li>
</ol>
<p><img loading="lazy" alt="show" src="/assets/images/31-e77e9f3eb5f87c91bb8d3d09e7c3401a.png" width="2560" height="1369" class="img_ev3q"></p>
<ol start="5">
<li>内存管理</li>
</ol>
<p><img loading="lazy" alt="show" src="/assets/images/32-db658cbaf3576030713ce08f0c9d44b5.png" width="2560" height="1367" class="img_ev3q"></p>
<ol start="6">
<li>事件管理</li>
</ol>
<p><img loading="lazy" alt="show" src="/assets/images/33-572f8458c2a4adfc2c03f0dfd7ae0960.png" width="2560" height="1367" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果-2">测试结果<a href="#测试结果-2" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<p>符合预期，可以证明 Grafana 监控功能够可以正常使用</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="eventsourcing-功能">EventSourcing 功能<a href="#eventsourcing-功能" class="hash-link" aria-label="EventSourcing 功能的直接链接" title="EventSourcing 功能的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-4">概述<a href="#概述-4" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>Phoenix 保证其内存数据正确性的核心原理在于 EventSourcing (事件溯源技术)。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍-3">原理介绍<a href="#原理介绍-3" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<p>Phoenix 是 EDA 架构的框架，可以基于事件重塑内存，Phoenix 会对所有处理过的事件进行持久化，在节点重启或者聚合根漂移时通过 EventSourcing 重塑内存状态。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案-3">测试方案<a href="#测试方案-3" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景描述-2">场景描述<a href="#场景描述-2" class="hash-link" aria-label="场景描述的直接链接" title="场景描述的直接链接">​</a></h4>
<p>使用 bank-account 提供的随机划拨功能，首先构造固定数量的请求，处理完成之后观察内存数据情况，然后重启节点后再次观察内存状态是否和之前保持一致，重启之后再进行定向划拨观察服务时候能够正常运作。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="校验方法-3">校验方法<a href="#校验方法-3" class="hash-link" aria-label="校验方法的直接链接" title="校验方法的直接链接">​</a></h4>
<p>在 bank-account 页面通过内存查询功能，观察最终的结果是否正确。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤-3">测试步骤<a href="#测试步骤-3" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<ol>
<li>使用 bank-account 的下单页面以每秒 100 笔的速率下单，同时限制账户个数为 10 个，划拨总次数为 1000</li>
<li>待所有请求处理完成之后，查询内存数据
<img loading="lazy" alt="show" src="/assets/images/5-6dab8acc96e61010e1eac3bbeff95c06.png" width="1690" height="368" class="img_ev3q"></li>
<li>重启服务之后，再次查询内存数据
重启过程中发现各个聚合根确实存在EventSourcing的过程
<img loading="lazy" alt="show" src="/assets/images/7-6e353070f9930158ba23db2aa8326590.png" width="1096" height="343" class="img_ev3q">
并且重启前后内存数据没有变化
<img loading="lazy" alt="show" src="/assets/images/6-6dab8acc96e61010e1eac3bbeff95c06.png" width="1690" height="368" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果-3">测试结果<a href="#测试结果-3" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<p>符合预期，可以证明 Phoenix 提供的 EventSourcing 功能够可以正常使用</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="snapshot-功能">Snapshot 功能<a href="#snapshot-功能" class="hash-link" aria-label="Snapshot 功能的直接链接" title="Snapshot 功能的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-5">概述<a href="#概述-5" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>Phoenix 应用可以通过 EventSourcing 功能进行内存数据恢复，使用 Snapshot 可以加快 EventSourcing 的内存恢复的速度。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍-4">原理介绍<a href="#原理介绍-4" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<p>Snapshot 是对某一瞬间 Phoenix 应用内存的一次存储。Phoenix 提供的快照功能提供了如下操作:</p>
<ol>
<li>单个聚合根默认每处理100000笔消息自动打一次快照，可以通过<code>@EntityAggregateAnnotation(snapshotInterval = 1000l)</code>进行设置</li>
<li>手动触发打快照</li>
<li>查询快照列表</li>
<li>查询指定聚合根最新状态</li>
<li>删除指定聚合根指定版本的快照</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案-4">测试方案<a href="#测试方案-4" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<p>Phoenix 服务提供了快照操作的相关接口，以下测试借助 phoenix admin 页面提供的快照功能进行测试</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景描述-3">场景描述<a href="#场景描述-3" class="hash-link" aria-label="场景描述的直接链接" title="场景描述的直接链接">​</a></h4>
<p>使用 bank-account 提供的随机划拨功能，首先构造一定数量的划拨请求，待处理完成之后执行手动打快照的请求。同时借助 phoenix admin 提供的内存管理功能进行快照列表的查询和删除指定版本快照的操作。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="校验方法-4">校验方法<a href="#校验方法-4" class="hash-link" aria-label="校验方法的直接链接" title="校验方法的直接链接">​</a></h4>
<p>每次操作之后，校验效果是否符合预期。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤-4">测试步骤<a href="#测试步骤-4" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<ol>
<li>使用 bank-account 的下单页面以每秒 100 笔的速率下单，同时限制账户个数为 10 个，划拨总次数为 1000</li>
<li>使用 phoenix admin 提供的内存管理功能给账户 A00000009 打一个快照
<img loading="lazy" alt="show" src="/assets/images/10-a1b03d97e7b5dd379fc9e945d026e980.png" width="2560" height="1369" class="img_ev3q"></li>
<li>接着使用 phoenix admin 查询快照列表
<img loading="lazy" alt="show" src="/assets/images/11-a2aaf8a3ecad15990bea6c8f094f925d.png" width="2560" height="1369" class="img_ev3q"></li>
<li>此时内存中各个账户的余额如下
<img loading="lazy" alt="show" src="/assets/images/12-da2a1b95a4f1dd23566557f1e6edf548.png" width="1239" height="355" class="img_ev3q"></li>
<li>从 A00000009 账户中转出 100 元，然后使用页面查询 A00000009 的最新状态
<img loading="lazy" alt="show" src="/assets/images/18-651edf35c5894ca31ef7560b46d5df19.png" width="2560" height="1369" class="img_ev3q"></li>
<li>使用 bank-account 的下单页面以每秒 1000 笔的速率下单，同时限制账户个数为 1 个，划拨总次数为 100000</li>
<li>查询快照列表，观察是否自动触发快照
<img loading="lazy" alt="show" src="/assets/images/15-bd31e61b0e810cd40f3e32c6429c51d8.png" width="2560" height="1369" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果-4">测试结果<a href="#测试结果-4" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<p>符合预期，可以证明 Phoenix 提供的 Snapshot 功能够可以正常使用</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="事务功能">事务功能<a href="#事务功能" class="hash-link" aria-label="事务功能的直接链接" title="事务功能的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-6">概述<a href="#概述-6" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>Phoenix 提供了一套分布式事务的解决方案，引入 phoenix-transaction 模块即可使用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍-5">原理介绍<a href="#原理介绍-5" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<p>bank-account 提供了随机转账和定向转账两个功能:</p>
<ol>
<li>定向转账:指定转出账户和转入账户，以及转账金额</li>
<li>随机转账:指定账户范围和转账次数，多个账户两两之间随机进行转账操作。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案-5">测试方案<a href="#测试方案-5" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<p>bank-account 构造了账户转账的案例，模拟了两个账户之间的转账操作。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景描述-4">场景描述<a href="#场景描述-4" class="hash-link" aria-label="场景描述的直接链接" title="场景描述的直接链接">​</a></h4>
<p>分别使用 bank-account 提供的两个转账接口进行下单测试。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="校验方法-5">校验方法<a href="#校验方法-5" class="hash-link" aria-label="校验方法的直接链接" title="校验方法的直接链接">​</a></h4>
<ul>
<li>定向转账:每次转账之后校验余额</li>
<li>随机转账:转入次数 = 转出次数 &amp;&amp; 转出次数 + 错误转出 = 转账次数</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤-5">测试步骤<a href="#测试步骤-5" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<ol>
<li>使用 bank-account 的下单页面以每秒 100 笔的速率下单，同时限制账户个数为 10 个，转账总次数为 1000</li>
<li>待下单完毕后，进行校验。使用 bank-account 的内存查询接口查询内存数据
<img loading="lazy" alt="show" src="/assets/images/16-0bfa9deee20c90a89d6de5d6e6d954a3.png" width="1692" height="364" class="img_ev3q"></li>
<li>使用定向转账功能，从 A00000000 账户向 A00000001 账户转入 100 元（通过以上图片发现经过随机转账之后 A00000000 账户中余额为 763 元，A00000001 账户中余额为 1240 元）
转账之后，通过内存查询接口查看账户余额
<img loading="lazy" alt="show" src="/assets/images/17-43b0ad3fac6e5128987356f71070a3dc.png" width="1688" height="530" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果-5">测试结果<a href="#测试结果-5" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<p>符合预期，可以证明 Phoenix 提供的事务功能够可以正常使用</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dgc-功能">DGC 功能<a href="#dgc-功能" class="hash-link" aria-label="DGC 功能的直接链接" title="DGC 功能的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-7">概述<a href="#概述-7" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>本测试针对 phoenix-dgc 提供的基本功能进行测试。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍-6">原理介绍<a href="#原理介绍-6" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<p>phoenix-dgc 的核心功能是通过对方法的结果进行缓存来达到 加速计算的效果，同时为了保证计算结果的准确性，如果涉及到属性值的更新，则会导致缓存失效。下面我们通过购物车案例来进行测试，看 DGC 功能是否能够正常使用</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案-6">测试方案<a href="#测试方案-6" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<p>通过下面这个案例，分别从多个维度进行测试：</p>
<ul>
<li>内存占比测试</li>
<li>性能对比测试</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DgcObjectManager</span><span class="token plain"> dgcObjectManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DgcObjectManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ShoppingCar</span><span class="token plain"> car </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dgcObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDgcObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShoppingCar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setDiscount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Order</span><span class="token plain"> order1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dgcObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDgcObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setItemName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;apple&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setQty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPrice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrderList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Order</span><span class="token plain"> order2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dgcObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDgcObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setItemName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;banana&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setQty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPrice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrderList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;first call car getTotalPayAmount&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTotalPayAmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;change discount then call car getTotalPayAmount&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setDiscount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTotalPayAmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;change order1 qty then call car getTotalPayAmount&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrderList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setQty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTotalPayAmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;{}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">DgcHelper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">showGraph</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">日志输出</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">first call car getTotalPayAmount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> get discount </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">1</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> get order itemName</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">apple</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> orderAmount</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">800</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> get order itemName</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">banana</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> orderAmount</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">200</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> calc total pay amount</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">1000</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change discount then call car getTotalPayAmount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> get discount </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">8</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> calc total pay amount</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">800</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change order1 qty then call car getTotalPayAmount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> get order itemName</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">apple</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> orderAmount</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">1600</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> calc total pay amount</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">1440</span><span class="token generics punctuation" style="color:#393A34">.</span><span class="token generics">0</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过上面案例中的日志输出，可以验证 DGC 功能正常。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤-6">测试步骤<a href="#测试步骤-6" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="内存占比测试">内存占比测试<a href="#内存占比测试" class="hash-link" aria-label="内存占比测试的直接链接" title="内存占比测试的直接链接">​</a></h4>
<p>DGC 为了达到加速的效果，会在内存中缓存方法的结果，以及方法之间的依赖关系。在 DGC 中将每个方法封装为 DgcKey</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DgcKey</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">Serializable</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> serialVersionUID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4176002715044714991L</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 代理对象 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 1. 调用Observable注解的成员对应的get方法(成员可能是基本类型，自定类，集合类) 2. 调用Compute注解的方法 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Method</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在整个依赖关系图中，每个节点都是一个 DgcNode, 每个节点中都包含了该节点的缓存值，以及该节点的孩子节点列表/父亲节点列表</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DgcNode</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">Serializable</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> serialVersionUID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2701772077242744179L</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 当前节点 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">DgcKey</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 当前节点计算结果 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 孩子节点 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">DgcKey</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> childKeySet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashSet</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 父亲节点 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">DgcKey</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> parentKeySet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashSet</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>下面我们通过一个案例来进行一组内存占比测试（该测试仅用来评估参考，具体内存占用情况，还需根据实际项目进行评估&amp;测试）</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="案例构造">案例构造<a href="#案例构造" class="hash-link" aria-label="案例构造的直接链接" title="案例构造的直接链接">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Getter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Setter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Order</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 物品名称 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Observable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> itemName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 物品数量 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Observable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> qty</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 物品价格 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Observable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> price</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 订单金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return orderAmount</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Compute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getOrderAmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">incrementAndGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> amount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getQty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getPrice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;* get order itemName&lt;{}&gt; orderAmount&lt;{}&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getItemName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">DgcObjectManager</span><span class="token plain"> dgcObjectManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DgcObjectManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token class-name">Order</span><span class="token plain"> order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dgcObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDgcObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setItemName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;apple&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setQty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPrice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrderAmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在上面的案例中，共构造了 10000 个 Order 对象，每个 Order 对象在内存中会存在 4 个 Dgckey (三个属性的 get 方法和 getOrderAmount() 方法)，以及 4 个 DgcNode。</p>
<p>执行完之后，内存中存在 40000 个 DgcKey 和 40000 个 DgcNode，他们的内存消耗情况如下：</p>
<p><img loading="lazy" alt="image-memory" src="/assets/images/memory-2661b35506fdce2cacb6e26d4a8d751b.png" width="1586" height="362" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="性能对比测试">性能对比测试<a href="#性能对比测试" class="hash-link" aria-label="性能对比测试的直接链接" title="性能对比测试的直接链接">​</a></h4>
<p>下面我们针对 DGC 的性能做一组对比测试，测试案例基于购物车案例进行改造。</p>
<p>根据购物车案例中的计算逻辑，我们可以得出如下依赖关系图。</p>
<p><img loading="lazy" alt="image-test" src="/assets/images/test-bf797068d565bc81ee22671bc427db4f.png" width="697" height="587" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="读多写少场景">读多写少场景<a href="#读多写少场景" class="hash-link" aria-label="读多写少场景的直接链接" title="读多写少场景的直接链接">​</a></h4>
<p>针对性能测试，我们对购物车案例进行如下改造：</p>
<ol>
<li>构造一个购物车实例</li>
<li>给购物车实例增加 1000 个订单实例</li>
<li>计算总金额（计算过程中，以一定的频率对购物车中的折扣进行重新赋值）</li>
</ol>
<p>为了模拟读多写少的场景，在测试中会以一定的频率重新设置 discount 的值（这个操作对于正常案例来说没有太大影响,对于 DGC 的场景来说,每次更新 discount 的值都会到时缓存失效,从而导致重新计算）</p>
<p>对上面的案例，分别用两种不同的实现来进行测试，最终得出性能对比结果。</p>
<p><strong>正常案例</strong></p>
<p>本案例没有使用 DGC 功能。方法的每次调用都会进行完整的计算逻辑。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** 正常案例 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">normal_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> crycle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ShoppingCar</span><span class="token plain"> car </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ShoppingCar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setDiscount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Order</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Order</span><span class="token plain"> order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setItemName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;apple&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setQty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPrice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOrderList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentTimeMillis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> crycle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setDiscount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTotalPayAmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;====&gt; [循环 &lt;{}&gt; 次] 未开启Dgc功能时耗时：&lt;{}&gt; ms&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            crycle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentTimeMillis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>DGC 案例</strong></p>
<p>本案例开启 DGC 功能，针对属性的 get 方法，以及 <code>@Compute</code> 注解标识的方法，每次计算过一次之后会对计算结果进行缓存，以达到加速效果。当计算逻辑中设计到的属性有更新时，会导致缓存失效。</p>
<p>在本案例中，我们通过以一定频率重新赋值购物车中的折扣的值，来模拟缓存失效的操作。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dgc_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> crycle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DgcObjectManager</span><span class="token plain"> dgcObjectManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DgcObjectManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ShoppingCar</span><span class="token plain"> car </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dgcObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDgcObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShoppingCar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setDiscount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Order</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Order</span><span class="token plain"> order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dgcObjectManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getDgcObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setItemName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;apple&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setQty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPrice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOrderList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentTimeMillis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> crycle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setDiscount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        car</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTotalPayAmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;====&gt; [循环 &lt;{}&gt; 次] 开启Dgc功能后耗时：&lt;{}&gt; ms&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            crycle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentTimeMillis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对上面的测试案例分别进行了10次测试，得出如下结果（结果取平均值）</p>
<table><thead><tr><th>循环次数</th><th>开启DGC(耗时/ms)</th><th>未开启DGC(耗时/ms)</th></tr></thead><tbody><tr><td>100</td><td>48</td><td>70</td></tr><tr><td>1000</td><td>10</td><td>74</td></tr><tr><td>10000</td><td>17</td><td>220</td></tr><tr><td>100000</td><td>20</td><td>2200</td></tr><tr><td>1000000</td><td>120</td><td>12800</td></tr><tr><td>10000000</td><td>1100</td><td>129000</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="写操作耗时场景">写操作耗时场景<a href="#写操作耗时场景" class="hash-link" aria-label="写操作耗时场景的直接链接" title="写操作耗时场景的直接链接">​</a></h4>
<p>为了模拟写操作比较耗时的的场景，在 ShoppingCar 的 getTotalPayAmount 方法中添加一个 1亿 次的空循环。</p>
<p>对上面的测试案例分别进行了10次测试，得出如下结果（结果取平均值）</p>
<table><thead><tr><th>循环次数</th><th>开启DGC(耗时/ms)</th><th>未开启DGC(耗时/ms)</th></tr></thead><tbody><tr><td>100</td><td>50</td><td>80</td></tr><tr><td>1000</td><td>23</td><td>90</td></tr><tr><td>10000</td><td>21</td><td>340</td></tr><tr><td>100000</td><td>20</td><td>2400</td></tr><tr><td>1000000</td><td>140</td><td>13600</td></tr><tr><td>10000000</td><td>1100</td><td>136000</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果-6">测试结果<a href="#测试结果-6" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<p>测试结果参考上面的测试过程。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="兼容性测试">兼容性测试<a href="#兼容性测试" class="hash-link" aria-label="兼容性测试的直接链接" title="兼容性测试的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-8">概述<a href="#概述-8" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>Phoenix 使用 JDBC 操作数据库，所以支持所有 JDBC 的数据库，同时 Phoenix 支持 k8s 环境运行和线下环境运行(以上测试全部在 k8s 环境操作，这里主要进行线下环境验证)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理介绍-7">原理介绍<a href="#原理介绍-7" class="hash-link" aria-label="原理介绍的直接链接" title="原理介绍的直接链接">​</a></h3>
<ol>
<li>k8s 环境运行 &amp; 线下环境运行:使用<code>java -jar</code>方式运行，组建 Akka 集群正常运行、案例正常。</li>
<li>EventStore 兼容性:分别使用 H2/Oracle/MySQL 作为数据源，测试业务逻辑正常。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试方案-7">测试方案<a href="#测试方案-7" class="hash-link" aria-label="测试方案的直接链接" title="测试方案的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景描述-5">场景描述<a href="#场景描述-5" class="hash-link" aria-label="场景描述的直接链接" title="场景描述的直接链接">​</a></h4>
<p>在一台机器上运行两个 bank-account 服务(需要配置两个服务端口不能冲突)，</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="校验方法-6">校验方法<a href="#校验方法-6" class="hash-link" aria-label="校验方法的直接链接" title="校验方法的直接链接">​</a></h4>
<ul>
<li>服务正常:在一个服务上进行划拨测试，检查测试结果是否和指令一致</li>
<li>Akka 集群正常组建:在另一个服务上查询内存信息是否与第一个服务信息一致。</li>
<li>EventStore 兼容性:更换数据源下单测试，查看内存数据是否符合预期</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤-7">测试步骤<a href="#测试步骤-7" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h3>
<ol>
<li>更换服务端口分别使用<code>mvn clean pakcage</code>编译，得到两个jar包。</li>
<li>通过<code>java -jar ***.jar</code>命令启动服务，这里启动两个用来测试集群组建，</li>
<li>通过其中一个bank-account页面<code>localhost:8080</code>，页面正常打开:
<img loading="lazy" alt="show" src="/assets/images/21-8ba71beb4707c5b76cf5b3ed399363ca.png" width="1593" height="660" class="img_ev3q"></li>
<li>划拨功能测试，这里设置划拨总数:1000，每秒次数:100，账户范围:10，等待交易完成后刷新页面:
<img loading="lazy" alt="show" src="/assets/images/19-eabc128db4d51655f426565ac8b08749.png" width="1609" height="688" class="img_ev3q"></li>
<li>然后访问Grafana监控页面可以查看bank-account服务的处理信息
<img loading="lazy" alt="show" src="/assets/images/22-b1910571acb22d640b373badc9476d25.png" width="2560" height="1369" class="img_ev3q"></li>
<li>更换jdbc重启服务测试下单，查看内存数据。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试结果-7">测试结果<a href="#测试结果-7" class="hash-link" aria-label="测试结果的直接链接" title="测试结果的直接链接">​</a></h3>
<ol>
<li>计算划拨总数1000为之前设定值，功能正常 (划拨总数 = 成功转出汇总 + 失败转出汇总 + 成功转入汇总)</li>
<li>通过 Grafana 监控页面的处理信息可以证明 Akka 集群组建成功</li>
<li>根据更换数据源下单后的内存数据可以证明 Phoenix 支持多数据源。</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/PhoenixIQ/versioned_docs/version-2.4.3/phoenix-2.x/06-phoenix-test/01-features-test.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/2.4.3/phoenix-2.x/phoenix-console/phoenix-console-system-monitor"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">系统监控</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/2.4.3/phoenix-2.x/phoenix-test/performance-test"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">性能测试</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#bank-account-划拨功能" class="table-of-contents__link toc-highlight">bank-account 划拨功能</a><ul><li><a href="#概述-1" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案" class="table-of-contents__link toc-highlight">测试方案</a><ul><li><a href="#场景描述" class="table-of-contents__link toc-highlight">场景描述</a></li><li><a href="#校验方法" class="table-of-contents__link toc-highlight">校验方法</a></li></ul></li><li><a href="#测试步骤" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#测试结果" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li><li><a href="#phoenix-metrics-功能" class="table-of-contents__link toc-highlight">phoenix metrics 功能</a><ul><li><a href="#概述-2" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍-1" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案-1" class="table-of-contents__link toc-highlight">测试方案</a><ul><li><a href="#场景描述-1" class="table-of-contents__link toc-highlight">场景描述</a></li><li><a href="#校验方法-1" class="table-of-contents__link toc-highlight">校验方法</a></li></ul></li><li><a href="#测试步骤-1" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#测试结果-1" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li><li><a href="#phoenix-console-功能" class="table-of-contents__link toc-highlight">phoenix console 功能</a><ul><li><a href="#概述-3" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍-2" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案-2" class="table-of-contents__link toc-highlight">测试方案</a><ul><li><a href="#校验方法-2" class="table-of-contents__link toc-highlight">校验方法</a></li></ul></li><li><a href="#测试步骤-2" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#测试结果-2" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li><li><a href="#eventsourcing-功能" class="table-of-contents__link toc-highlight">EventSourcing 功能</a><ul><li><a href="#概述-4" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍-3" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案-3" class="table-of-contents__link toc-highlight">测试方案</a><ul><li><a href="#场景描述-2" class="table-of-contents__link toc-highlight">场景描述</a></li><li><a href="#校验方法-3" class="table-of-contents__link toc-highlight">校验方法</a></li></ul></li><li><a href="#测试步骤-3" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#测试结果-3" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li><li><a href="#snapshot-功能" class="table-of-contents__link toc-highlight">Snapshot 功能</a><ul><li><a href="#概述-5" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍-4" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案-4" class="table-of-contents__link toc-highlight">测试方案</a><ul><li><a href="#场景描述-3" class="table-of-contents__link toc-highlight">场景描述</a></li><li><a href="#校验方法-4" class="table-of-contents__link toc-highlight">校验方法</a></li></ul></li><li><a href="#测试步骤-4" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#测试结果-4" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li><li><a href="#事务功能" class="table-of-contents__link toc-highlight">事务功能</a><ul><li><a href="#概述-6" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍-5" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案-5" class="table-of-contents__link toc-highlight">测试方案</a><ul><li><a href="#场景描述-4" class="table-of-contents__link toc-highlight">场景描述</a></li><li><a href="#校验方法-5" class="table-of-contents__link toc-highlight">校验方法</a></li></ul></li><li><a href="#测试步骤-5" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#测试结果-5" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li><li><a href="#dgc-功能" class="table-of-contents__link toc-highlight">DGC 功能</a><ul><li><a href="#概述-7" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍-6" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案-6" class="table-of-contents__link toc-highlight">测试方案</a></li><li><a href="#测试步骤-6" class="table-of-contents__link toc-highlight">测试步骤</a><ul><li><a href="#内存占比测试" class="table-of-contents__link toc-highlight">内存占比测试</a></li><li><a href="#案例构造" class="table-of-contents__link toc-highlight">案例构造</a></li><li><a href="#性能对比测试" class="table-of-contents__link toc-highlight">性能对比测试</a></li><li><a href="#读多写少场景" class="table-of-contents__link toc-highlight">读多写少场景</a></li><li><a href="#写操作耗时场景" class="table-of-contents__link toc-highlight">写操作耗时场景</a></li></ul></li><li><a href="#测试结果-6" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li><li><a href="#兼容性测试" class="table-of-contents__link toc-highlight">兼容性测试</a><ul><li><a href="#概述-8" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#原理介绍-7" class="table-of-contents__link toc-highlight">原理介绍</a></li><li><a href="#测试方案-7" class="table-of-contents__link toc-highlight">测试方案</a><ul><li><a href="#场景描述-5" class="table-of-contents__link toc-highlight">场景描述</a></li><li><a href="#校验方法-6" class="table-of-contents__link toc-highlight">校验方法</a></li></ul></li><li><a href="#测试步骤-7" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#测试结果-7" class="table-of-contents__link toc-highlight">测试结果</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduce">Phoenix介绍</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/phoenix/quick-start-example/bookings-architecture">快速入门</a></li></ul></div><div class="col footer__col"><div class="footer__title">案例</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/PhoenixIQ/phoenix-samples/tree/master/bank-account" target="_blank" rel="noopener noreferrer" class="footer__link-item">账户管理<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/PhoenixIQ/phoenix-sample-risk" target="_blank" rel="noopener noreferrer" class="footer__link-item">交易风控<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/PhoenixIQ/phoenix-samples/tree/master/shopping-cart" target="_blank" rel="noopener noreferrer" class="footer__link-item">购物车<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/PhoenixIQ/hotel-booking" target="_blank" rel="noopener noreferrer" class="footer__link-item">酒店预订<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">资源</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">北京宽拓智融科技有限公司 Copyright @2013 - 2023 iQuantex.com All Rights Reserved. 宽拓公司 版权所有</div></div></div></footer></div>
</body>
</html>