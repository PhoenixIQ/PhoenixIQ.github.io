"use strict";(self.webpackChunkphoenix_website_next=self.webpackChunkphoenix_website_next||[]).push([[44263],{99809:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>s,metadata:()=>r,toc:()=>h});var a=i(85893),t=i(11151);const s={id:"phoenix-admin-use-2x",title:"\u4f7f\u7528\u8bf4\u660e"},o=void 0,r={id:"phoenix-2.x/phoenix-admin/phoenix-admin-use-2x",title:"\u4f7f\u7528\u8bf4\u660e",description:"\u8fd0\u884c\u542f\u52a8",source:"@site/versioned_docs/version-2.2.4/phoenix-2.x/04-phoenix-admin/02-use.md",sourceDirName:"phoenix-2.x/04-phoenix-admin",slug:"/phoenix-2.x/phoenix-admin/phoenix-admin-use-2x",permalink:"/docs/2.2.4/phoenix-2.x/phoenix-admin/phoenix-admin-use-2x",draft:!1,unlisted:!1,editUrl:"https://github.com/PhoenixIQ/versioned_docs/version-2.2.4/phoenix-2.x/04-phoenix-admin/02-use.md",tags:[],version:"2.2.4",sidebarPosition:2,frontMatter:{id:"phoenix-admin-use-2x",title:"\u4f7f\u7528\u8bf4\u660e"},sidebar:"docs",previous:{title:"\u529f\u80fd\u4ecb\u7ecd",permalink:"/docs/2.2.4/phoenix-2.x/phoenix-admin/phoenix-admin-readme-2x"},next:{title:"\u529f\u80fd\u6027\u6d4b\u8bd5",permalink:"/docs/2.2.4/phoenix-2.x/phoenix-test/features-test-2x"}},c={},h=[{value:"\u8fd0\u884c\u542f\u52a8",id:"\u8fd0\u884c\u542f\u52a8",level:2},{value:"\u9879\u76ee\u914d\u7f6e",id:"\u9879\u76ee\u914d\u7f6e",level:2},{value:"\u65b0\u5efa\u9879\u76ee",id:"\u65b0\u5efa\u9879\u76ee",level:4},{value:"\u914d\u7f6e\u9879\u8bf4\u660e",id:"\u914d\u7f6e\u9879\u8bf4\u660e",level:4},{value:"\u4e0a\u62a5\u914d\u7f6e",id:"\u4e0a\u62a5\u914d\u7f6e",level:2},{value:"\u4f7f\u7528jmx\u76d1\u63a7\u670d\u52a1\u6027\u80fd",id:"\u4f7f\u7528jmx\u76d1\u63a7\u670d\u52a1\u6027\u80fd",level:2},{value:"docker-compose\u53d8\u66f4",id:"docker-compose\u53d8\u66f4",level:3},{value:"\u4f7f\u7528rancher\u64cd\u4f5c",id:"\u4f7f\u7528rancher\u64cd\u4f5c",level:4},{value:"\u68c0\u67e5\u670d\u52a1\u662f\u5426\u88ab\u76d1\u63a7",id:"\u68c0\u67e5\u670d\u52a1\u662f\u5426\u88ab\u76d1\u63a7",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"\u8fd0\u884c\u542f\u52a8",children:"\u8fd0\u884c\u542f\u52a8"}),"\n",(0,a.jsx)(n.p,{children:"phoenix-admin\u53ef\u4ee5\u901a\u8fc7rancher\u5e94\u7528\u5546\u5e97\u8fdb\u884c\u4e00\u952e\u90e8\u7f72"}),"\n",(0,a.jsx)(n.h2,{id:"\u9879\u76ee\u914d\u7f6e",children:"\u9879\u76ee\u914d\u7f6e"}),"\n",(0,a.jsx)(n.h4,{id:"\u65b0\u5efa\u9879\u76ee",children:"\u65b0\u5efa\u9879\u76ee"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"image-20200115193059777",src:i(53887).Z+"",width:"2234",height:"914"})}),"\n",(0,a.jsx)(n.h4,{id:"\u914d\u7f6e\u9879\u8bf4\u660e",children:"\u914d\u7f6e\u9879\u8bf4\u660e"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"image-20200115200309243",src:i(27661).Z+"",width:"1614",height:"1100"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u9879\u76eeID\uff1a\nPhoenix\u9879\u76ee\u7684ID\uff0c\u5168\u5c40\u552f\u4e00\uff0c\u5efa\u8bae\u4f7f\u7528\u82f1\u6587+\u5b57\u6bcd\u7684\u7b80\u77ed\u7ec4\u5408\u3002"}),"\n",(0,a.jsx)(n.li,{children:"\u9879\u76ee\u540d\u79f0\uff1a\nPhoenix\u9879\u76ee\u7684\u540d\u79f0\u3002"}),"\n",(0,a.jsx)(n.li,{children:"\u9879\u76ee\u63cf\u8ff0\uff1a\nPhoenix\u9879\u76ee\u7684\u7b80\u77ed\u63cf\u8ff0\u3002"}),"\n",(0,a.jsx)(n.li,{children:"\u6ce8\u518c\u4e2d\u5fc3\u5730\u5740\uff1a\nphoenix-admin\u80fd\u5b9e\u73b0\u591a\u9879\u76ee\u7684\u7ba1\u7406\uff0c\u501f\u4f4f\u4e86eureka\u6765\u5b9e\u73b0\u5404\u4e2a\u9879\u76ee\u5185\u7684\u670d\u52a1\u53d1\u73b0\u3002\u8fd9\u91cc\u9700\u8981\u586b\u5199\u5728\u90e8\u7f72Phoenix\u9879\u76ee\u7684\u65f6\u5019\uff0ceureka\u7684\u5730\u5740\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u4e0a\u62a5\u914d\u7f6e",children:"\u4e0a\u62a5\u914d\u7f6e"}),"\n",(0,a.jsxs)(n.p,{children:["phoenix-admin\u53ef\u4ee5\u76d1\u542cphoenix-event-publish\u670d\u52a1\u4e0a\u62a5\u7684\u7684\u4fe1\u606f\uff0c\u5728\u9875\u9762\u4e2d\u914d\u7f6ephoenix\u5e94\u7528\u901a\u8baf\u6240\u4f9d\u8d56\u7684MQ\u7684\u5730\u5740\u548ctopic\u5217\u8868\uff0c\u914d\u7f6e\u5b8c\u6210\u4e4b\u540e\u5373\u53ef\u4ecegrafna\u4e0a",(0,a.jsx)(n.code,{children:"phoenix-message"}),"\u9875\u9762\u67e5\u770b\u5904\u7406\u5185\u5bb9"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"\u4e0a\u62a5\u914d\u7f6e",src:i(65023).Z+"",width:"1808",height:"943"})}),"\n",(0,a.jsx)(n.p,{children:"phoenix-message\u76d1\u63a7\u9875\u9762"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"\u9996\u9875",src:i(8086).Z+"",width:"2187",height:"1137"})}),"\n",(0,a.jsx)(n.h2,{id:"\u4f7f\u7528jmx\u76d1\u63a7\u670d\u52a1\u6027\u80fd",children:"\u4f7f\u7528jmx\u76d1\u63a7\u670d\u52a1\u6027\u80fd"}),"\n",(0,a.jsx)(n.h3,{id:"docker-compose\u53d8\u66f4",children:"docker-compose\u53d8\u66f4"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u5f15\u5165Prometheus\u914d\u7f6e\u955c\u50cf"}),"\n",(0,a.jsxs)(n.li,{children:["\u62f7\u8d1d\u955c\u50cf\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u5230",(0,a.jsx)(n.code,{children:"/prometheus-agent"}),"\u76ee\u5f55"]}),"\n",(0,a.jsx)(n.li,{children:"\u5728\u542f\u52a8\u670d\u52a1\u65f6\u9700\u8981\u6dfb\u52a0\u4ee5\u4e0b\u6307\u4ee4"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"-javaagent:/prometheus-agent/jmx_prometheus_javaagent.jar=8888:/prometheus-agent/config.yml"})}),"\n",(0,a.jsx)(n.p,{children:"\u63a5\u5165\u793a\u4f8b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dockerfile",children:'#\u589e\u52a0Prometheus\u914d\u7f6e\u955c\u50cf,\u8d77\u4e00\u4e2a\u522b\u540d\u4e3aagent\nFROM harbor.iquantex.com/phoenix/prometheus-agent:1.0.0 as agent\nFROM harbor.iquantex.com/base_images/openjdk:8u212-jre-with-tool\n\nMAINTAINER "lan"\n\nVOLUME /tmp\n\n#\u62f7\u8d1d\u955c\u50cf\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u5230\u6307\u5b9a\u76ee\u5f55\nCOPY --from=agent /prometheus-agent/ /prometheus-agent\nADD app.jar app.jar\n\n#\u589e\u52a0-javaagent:/prometheus-agent/jmx_prometheus_javaagent.jar=8888:/prometheus-agent/config.yml\nENTRYPOINT java -jar -javaagent:/prometheus-agent/jmx_prometheus_javaagent.jar=8888:/prometheus-agent/config.yml ${JAVA_OPTS} -XX:+UseConcMarkSweepGC -XX:+UseContainerSupport -XX:InitialRAMPercentage=75.0 -XX:MinRAMPercentage=75.0 -XX:MaxRAMPercentage=75.0  -XshowSettings:vm /app.jar\n\u200b```\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u66b4\u9732",(0,a.jsx)(n.code,{children:"jmx"}),"\u91c7\u96c6\u6570\u636e\u7684\u7aef\u53e3\uff0chelm-chart\u6587\u4ef6\u5982\u4e0b\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    prometheus.io/path: /metrics\n    prometheus.io/port: "8888"\n    prometheus.io/scheme: http\n    prometheus.io/phoenix_scrape: "true"\n  name: phoenix-metric\nspec:\n  ports:\n  - name: default\n    port: 80\n    protocol: TCP\n    targetPort: 8888\n    selector:\n    apptype: phoenix\n    type: ClusterIP\nstatus:\n    loadBalancer: {}\n\u200b```\n\n\u540c\u65f6\u8981\u5728\u670d\u52a1\u7684helm chart\u4e2d\u589e\u52a0\u6807\u7b7e\n\n\u200b```yaml\nspec:\n  template:\n    metadata:\n      labels:\n        app.name: bank-account\n        apptype: phoenix\n\u200b```\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u4f7f\u7528rancher\u64cd\u4f5c",children:"\u4f7f\u7528rancher\u64cd\u4f5c"}),"\n",(0,a.jsx)(n.p,{children:"rancher => \u670d\u52a1\u53d1\u73b0 => \u6dfb\u52a0DNS\u8bb0\u5f55"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:i(75122).Z+"",width:"1967",height:"750"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:i(71465).Z+"",width:"1991",height:"874"})}),"\n",(0,a.jsxs)(n.p,{children:["\u88ab\u76d1\u63a7\u7684\u670d\u52a1\u589e\u52a0\u4ee5\u4e0b\u6807\u7b7e\n",(0,a.jsx)(n.img,{src:i(86671).Z+"",width:"898",height:"644"})]}),"\n",(0,a.jsx)(n.h3,{id:"\u68c0\u67e5\u670d\u52a1\u662f\u5426\u88ab\u76d1\u63a7",children:"\u68c0\u67e5\u670d\u52a1\u662f\u5426\u88ab\u76d1\u63a7"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u901a\u8fc7\u8bbf\u95ee\u672c\u5730\u7aef\u53e3\u6765\u67e5\u770b\u662f\u5426\u66b4\u9732\u76d1\u63a7\u6570\u636e"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u8fdb\u5165\u5bb9\u5668\u8bbf\u95ee8888\u7aef\u53e3\uff0c\u67e5\u770b\u662f\u5426\u6709\u66b4\u9732",(0,a.jsx)(n.code,{children:"com_iquantex_Phoenix"}),"\u6253\u5934\u7684\u76d1\u63a7\u4fe1\u606f"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'bash-5.0# curl localhost:8888\n...\n# HELP com_iquantex_Phoenix_ReceiverActor_NoHandlerMessageTotal Attribute exposed for management (com.iquantex.Phoenix<type=ReceiverActor,  aggregateRootId=kafka-9092-account-web-event-0><>NoHandlerMessageTotal)\n# TYPE com_iquantex_Phoenix_ReceiverActor_NoHandlerMessageTotal untyped\ncom_iquantex_Phoenix_ReceiverActor_NoHandlerMessageTotal{_aggregateRootId="kafka-9092-account-web-event-0",} 0.0\ncom_iquantex_Phoenix_ReceiverActor_NoHandlerMessageTotal{_aggregateRootId="kafka-9092-account-server-2",} 0.0\ncom_iquantex_Phoenix_ReceiverActor_NoHandlerMessageTotal{_aggregateRootId="kafka-9092-account-web-event-2",} 0.0\ncom_iquantex_Phoenix_ReceiverActor_NoHandlerMessageTotal{_aggregateRootId="kafka-9092-account-server-0",} 0.0\n...\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u901a\u8fc7Prometheus\u67e5\u770b\u76d1\u63a7\u4fe1\u606f"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u901a\u8fc7Prometheus\u670d\u52a1\u7684targets\u9875\u9762\u67e5\u770b\u662f\u5426\u6709\u88ab\u76d1\u63a7\u7684\u670d\u52a1"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:i(97076).Z+"",width:"1654",height:"922"})})]})}function l(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},27661:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/002-a7c0a99bdc04be18df18c133544e7716.png"},53887:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/005-691bcdb7319b641451ac514097a70e0e.png"},8086:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/010-b7fa53c866070a77340918f4d4c6634b.png"},75122:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/021-82a00c4e252ff6c03685ae41697ff3e9.png"},71465:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/022-d3f9cbc8c1b159f406b36bdadf971cba.png"},86671:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/023-2d36cd2268d4319ace4f4c5412e39b1f.png"},97076:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/024-ac8ec672cf645771101785b176da9c8c.png"},65023:(e,n,i)=>{i.d(n,{Z:()=>a});const a=i.p+"assets/images/026-fe5c9fdb21d1046567cdf8ed3bc393ed.png"},11151:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>o});var a=i(67294);const t={},s=a.createContext(t);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);